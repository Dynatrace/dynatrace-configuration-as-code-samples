{
  "displayName": "{{.pipelineDisplayName}}",
  "customId": "{{.pipelineCustomName}}",
  "processing": {
    "processors": [
      {
        "type": "dql",
        "matcher": "isNotNull(action)",
        "description": "add event.status",
        "id": "processor_add_event_status",
        "enabled": true,
        "sampleData": null,
        "dql": {
          "script": "fieldsAdd event.status = concat(action,\"d\")"
        }
      },
      {
        "type": "dql",
        "matcher": "object_kind == \"release\" and action == \"create\"",
        "description": "add start_time",
        "id": "processor_add_start_time",
        "enabled": true,
        "sampleData": null,
        "dql": {
          "script": "fieldsAdd start_time = toTimestamp(created_at)"
        }
      },
      {
        "type": "dql",
        "matcher": "object_kind == \"release\"",
        "description": "add release properties",
        "id": "processor_add_release_properties",
        "enabled": true,
        "sampleData": null,
        "dql": {
          "script": "fieldsAdd task.id = id\n| fieldsAdd task.name = \"GitLab Release\"\n| fieldsAdd release.name = name\n| fieldsAdd release.description = description\n| fieldsAdd release.url.full = url\n| fieldsAdd vcs.ref.base.name = tag\n| fieldsAdd ext.release.time = toTimestamp(released_at)"
        }
      },
      {
        "type": "dql",
        "matcher": "isNotNull(commit)",
        "description": "add vcs.ref.base.revision",
        "id": "processor_add_vcs_ref_base_revision",
        "enabled": true,
        "sampleData": null,
        "dql": {
          "script": "parse commit, \"JSON:commit_j\"\n| fieldsAdd vcs.ref.base.revision = commit_j[id]\n| fieldsRemove commit_j"
        }
      },
      {
        "type": "dql",
        "matcher": "isNotNull(project)",
        "description": "add project properties",
        "id": "processor_add_project_properties",
        "enabled": true,
        "sampleData": null,
        "dql": {
          "script": "parse project, \"JSON:project_j\"\n| fieldsAdd ext.project.id = project_j[id]\n| fieldsAdd vcs.repository.url.full = project_j[web_url]\n| fieldsAdd vcs.repository.name = project_j[name]\n| fieldsRemove project_j"
        }
      },
      {
        "type": "fieldsRemove",
        "matcher": "true",
        "description": "Clean up",
        "id": "processor_fields_remove",
        "enabled": true,
        "sampleData": null,
        "fieldsRemove": {
          "fields": [
            "id",
            "created_at",
            "description",
            "name",
            "released_at",
            "tag",
            "object_kind",
            "project",
            "url",
            "action",
            "assets",
            "commit"
          ]
        }
      }
    ]
  }
}
