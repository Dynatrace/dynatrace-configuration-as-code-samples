{
  "displayName": "{{.pipelineDisplayName}}",
  "customId": "{{.pipelineCustomName}}",
  "processing": {
    "processors": [
      {
        "id": "processor_add_release_properties",
        "type": "dql",
        "matcher": "true",
        "description": "Add release properties",
        "enabled": true,
        "dql": {
          "script": "fieldsAdd task.name = \"GitLab Release\"\n| fieldsAdd ext.release.time = toTimestamp(released_at)\n| fieldsAdd start_time = if(action == \"create\", toTimestamp(created_at))\n| fieldsAdd event.status = if(isNotNull(action), concat(action,\"d\"))\n\n| fieldsRename task.id = id\n| fieldsRename release.name = name\n| fieldsRename release.description = description\n| fieldsRename release.url.full = url\n| fieldsRename vcs.ref.base.name = tag\n"
        }
      },
      {
        "id": "processor_add_commit_properties",
        "type": "dql",
        "matcher": "isNotNull(commit)",
        "description": "Add commit properties",
        "enabled": true,
        "dql": {
          "script": "parse commit, \"JSON{STRING:id}:commit\"\n| fieldsFlatten commit, fields:{ id }\n\n| fieldsRename vcs.ref.base.revision = id\n\n| fieldsRemove commit\n"
        }
      },
      {
        "id": "processor_add_project_properties",
        "type": "dql",
        "matcher": "isNotNull(project)",
        "description": "Add project properties",
        "enabled": true,
        "dql": {
          "script": "parse project, \"JSON{LONG:id, STRING:web_url, STRING:name}:project\"\n| fieldsFlatten project, fields: { id, web_url, name }\n\n| fieldsRename ext.project.id = id\n| fieldsRename vcs.repository.url.full = web_url\n| fieldsRename vcs.repository.name = name\n\n| fieldsRemove project\n"
        }
      },
      {
        "id": "processor_clean_up",
        "type": "dql",
        "matcher": "true",
        "description": "Clean up",
        "enabled": true,
        "dql": {
          "script": "fieldsKeep\n  event.kind,\n  event.status,\n  event.id,\n  event.provider,\n  event.category,\n  event.type,\n  event.version,\n  start_time,\n  timestamp,\n  ext.release.time,\n  task.id,\n  release.name,\n  release.description,\n  release.url.full,\n  vcs.ref.base.name,\n  vcs.ref.base.revision,\n  ext.project.id,\n  vcs.repository.url.full,\n  vcs.repository.name\n"
        }
      }
    ]
  }
}
